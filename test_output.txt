
> invoicing-pipeline@0.0.1 test
> jest "src/invoices/invoices.service.spec.ts"

FAIL src/invoices/invoices.service.spec.ts
  InvoicesService
    ΓêÜ should be defined (11 ms)
    generateInvoice
      ├ù should generate an invoice and group charges by metric type (3 ms)
      ├ù should apply customer credits and reduce total (2 ms)
      ├ù should apply regional tax (EU-DE - 19%) (1 ms)
      ├ù should apply currency conversion (BRL - 5.0) (1 ms)
      ΓêÜ should generate a correction invoice if an issued invoice exists (3 ms)
    exportToCsv
      ΓêÜ should generate a CSV string (2 ms)
    findOne
      ΓêÜ should return an invoice with line items (1 ms)
      ΓêÜ should throw NotFoundException if invoice not found (2 ms)
    issueInvoice
      ΓêÜ should mark invoice as issued (2 ms)

  ΓùÅ InvoicesService ΓÇ║ generateInvoice ΓÇ║ should generate an invoice and group charges by metric type

    TypeError: Cannot read properties of undefined (reading 'find')

      51 |     });
      52 |
    > 53 |     const issuedInvoice = existingInvoices.find(
         |                                            ^
      54 |       (inv) => inv.status === 'issued' || inv.status === 'paid',
      55 |     );
      56 |

      at InvoicesService.generateInvoice (src/invoices/invoices.service.ts:53:44)
      at Object.<anonymous> (src/invoices/invoices.service.spec.ts:140:22)

  ΓùÅ InvoicesService ΓÇ║ generateInvoice ΓÇ║ should apply customer credits and reduce total

    TypeError: Cannot read properties of undefined (reading 'find')

      51 |     });
      52 |
    > 53 |     const issuedInvoice = existingInvoices.find(
         |                                            ^
      54 |       (inv) => inv.status === 'issued' || inv.status === 'paid',
      55 |     );
      56 |

      at InvoicesService.generateInvoice (src/invoices/invoices.service.ts:53:44)
      at Object.<anonymous> (src/invoices/invoices.service.spec.ts:195:22)

  ΓùÅ InvoicesService ΓÇ║ generateInvoice ΓÇ║ should apply regional tax (EU-DE - 19%)

    TypeError: Cannot read properties of undefined (reading 'find')

      51 |     });
      52 |
    > 53 |     const issuedInvoice = existingInvoices.find(
         |                                            ^
      54 |       (inv) => inv.status === 'issued' || inv.status === 'paid',
      55 |     );
      56 |

      at InvoicesService.generateInvoice (src/invoices/invoices.service.ts:53:44)
      at Object.<anonymous> (src/invoices/invoices.service.spec.ts:244:22)

  ΓùÅ InvoicesService ΓÇ║ generateInvoice ΓÇ║ should apply currency conversion (BRL - 5.0)

    TypeError: Cannot read properties of undefined (reading 'find')

      51 |     });
      52 |
    > 53 |     const issuedInvoice = existingInvoices.find(
         |                                            ^
      54 |       (inv) => inv.status === 'issued' || inv.status === 'paid',
      55 |     );
      56 |

      at InvoicesService.generateInvoice (src/invoices/invoices.service.ts:53:44)
      at Object.<anonymous> (src/invoices/invoices.service.spec.ts:292:22)

Test Suites: 1 failed, 1 total
Tests:       4 failed, 6 passed, 10 total
Snapshots:   0 total
Time:        2.896 s, estimated 3 s
Ran all test suites matching /src\\invoices\\invoices.service.spec.ts/i.
